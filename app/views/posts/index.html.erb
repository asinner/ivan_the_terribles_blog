<% cache 'v9' do %>

<h1>Ivan the Terrible's Blog</h1>

<section class="blog">
	<% @posts.each do |post| %>
			<section class="post">
			  <h2>Post <%= "#{post.id}: #{post.title}" %></h2>
			  <div class="post" data-msg='<%= post.body %>'>
					<%= truncate(post.body, length: 160) %>
					<%= link_to 'More ›', '#', onclick: 'reveal(this);' %>
				</div>
				<div class="post_nav">
				  <%= link_to 'Show', post %> |
				  <%= link_to 'Edit', edit_post_path(post) %> |
				  <%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } %>
				</div>

				<% post.comments.each do |comment| %>
				
					<div class="comment">
					  <h3>Comment <%= comment.id %>:</h3>
					  <p data-msg='<%= comment.body %>'>
							<%= truncate(comment.body, length: 160) %>
							<%= link_to 'More ›', '#', onclick: 'reveal(this);' %>
						</p>
					  <div class="reply">
							<% comment.replies.each do |reply| %>
								<h4>Reply <%= reply.id %>:</h4>
								<p data-msg='<%= reply.body %>'>
									<%= truncate(reply.body, length: 160) %>
									<%= link_to 'More ›', '#', onclick: 'reveal(this);' %>
								</p>
							<% end %>
					  </div>
					</div>
					
				
				<% end %>
				
			</section>
			
	<% end %>
</section>

<br />

<%= link_to 'New Post', new_post_path %>

<% end %>